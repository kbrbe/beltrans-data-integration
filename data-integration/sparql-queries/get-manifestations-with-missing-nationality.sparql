prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>
prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
prefix prov: <http://www.w3.org/ns/prov#>
prefix dc: <http://purl.org/dc/elements/1.1/>
prefix dcterms: <http://purl.org/dc/terms/>
prefix schema: <http://schema.org/>
prefix bibo: <http://purl.org/ontology/bibo/>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX btm: <http://kbr.be/ns/beltrans/model#>
PREFIX btid: <http://kbr.be/id/data/> 
PREFIX marcrel: <http://id.loc.gov/vocabulary/relators/> 
PREFIX bf: <http://id.loc.gov/ontologies/bibframe/>
PREFIX btisni: <http://kbr.be/isni/>
PREFIX mads: <http://www.loc.gov/mads/rdf/v1#>
PREFIX up: <http://users.ugent.be/~tdenies/up/>

SELECT DISTINCT
  ?manifestationID
  (group_concat(distinct ?authorID;SEPARATOR=';') AS ?autID)
#  ?authorFamilyName
#  ?authorGivenName
  (group_concat(distinct ?allNat;SEPARATOR=';') AS ?allNationality)
  (group_concat(distinct ?authorNationality;SEPARATOR=';') AS ?autNat)
  (group_concat(distinct ?illustratorID;SEPARATOR=';') AS ?illID)
#  ?illustratorFamilyName
#  ?illustratorGivenName
  (group_concat(distinct ?illustratorNationality;SEPARATOR=';') AS ?illNat)
  (group_concat(distinct ?scenaristID;SEPARATOR=';') AS ?sceID)
#  ?scenaristFamilyName
#  ?scenaristGivenName
  (group_concat(distinct ?scenaristNationality;SEPARATOR=';') AS ?sceNat)
  (group_concat(distinct ?publishingDirectorID;SEPARATOR=';') AS ?pbdID)
#  ?publishingDirectorFamilyName
#  ?publishingDirectorGivenName
  (group_concat(distinct ?publishingDirectorNationality;SEPARATOR=';') AS ?pbdNat)
WHERE {
  
  graph <http://beltrans-manifestations> {
    ?manifestation a schema:CreativeWork ;
                   dcterms:identifier ?manifestationID .
  }
         
  # AUTHOR
  OPTIONAL { 
      graph <http://beltrans-manifestations> { ?manifestation schema:author ?author . }
      OPTIONAL { graph <http://beltrans-contributors> { ?author dcterms:identifier ?authorID . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?author schema:familyName ?authorFamilyName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?author schema:givenName ?authorGivenName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?author schema:nationality ?authorNationality . } }
  }

  # ILLUSTRATOR
  OPTIONAL { 
      graph <http://beltrans-manifestations> { ?manifestation marcrel:ill ?illustrator . }
      OPTIONAL { graph <http://beltrans-contributors> { ?illustrator dcterms:identifier ?illustratorID . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?illustrator schema:familyName ?illustratorFamilyName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?illustrator schema:givenName ?illustratorGivenName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?illustrator schema:nationality ?illustratorNationality . } }
  }

  # SCENARIST
  OPTIONAL { 
      graph <http://beltrans-manifestations> { ?manifestation marcrel:sce ?scenarist . }
      OPTIONAL { graph <http://beltrans-contributors> { ?scenarist dcterms:identifier ?scenaristID . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?scenarist schema:familyName ?scenaristFamilyName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?scenarist schema:givenName ?scenaristGivenName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?scenarist schema:nationality ?scenaristNationality . } }
  }

  # PUBLISHING DIRECTOR
  OPTIONAL { 
      graph <http://beltrans-manifestations> { ?manifestation marcrel:sce ?publishingDirector . }
      OPTIONAL { graph <http://beltrans-contributors> { ?publishingDirector dcterms:identifier ?publishingDirectorID . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?publishingDirector schema:familyName ?publishingDirectorFamilyName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?publishingDirector schema:givenName ?publishingDirectorGivenName . } }
      OPTIONAL { graph <http://beltrans-contributors> { ?publishingDirector schema:nationality ?publishingDirectorNationality . } }
  }


  BIND( IF(bound(?author) && !bound(?authorNationality), "MISSING", STR(?authorNationality)) AS ?authorNat)
  BIND( IF(bound(?illustrator) && !bound(?illustratorNationality), "MISSING", STR(?illustratorNationality)) AS ?illustratorNat)
  BIND( IF(bound(?scenarist) && !bound(?scenaristNationality), "MISSING", STR(?scenaristNationality)) AS ?scenaristNat)
  BIND( IF(bound(?publishingDirector) && !bound(?publishingDirectorNationality), "MISSING", STR(?publishingDirectorNationality)) AS ?publishingDirectorNat)
  BIND( CONCAT(?authorNat, ?illustratorNat, ?scenaristNat, ?publishingDirectorNat) AS ?allNat)

}
GROUP BY ?manifestationID
