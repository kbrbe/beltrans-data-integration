#
# Definition of the Blazegraph db
# 
upstream docker-blazegraph {
  server blazegraph:8080;
}
#
# HTTP traffic
#
server {
  listen 80;

  proxy_connect_timeout 600;
  proxy_send_timeout    600;
  proxy_read_timeout    600;
  send_timeout          600;

  #
  # Do not show the nginx version on error pages
  #
  server_tokens off;

  proxy_set_header Host          $http_host;
  proxy_set_header X-Real-IP     $remote_addr;
  proxy_set_header X-Forward-For $proxy_add_x_forwarded_for;

  location / {
    root /www/data;
    index index.html;
  }

  location /sparql/ {


    proxy_connect_timeout 6000;
    proxy_send_timeout    6000;
    proxy_read_timeout    6000;
    send_timeout          6000;
    client_max_body_size  200M;

    #
    # For all other than GET requets require an authentication
    #
    limit_except GET {
      auth_basic           "Authentication required";
      auth_basic_user_file /etc/nginx/conf.d/.htpasswd;
    }

    proxy_pass http://docker-blazegraph/bigdata/;

    # Allow CORS
    add_header Access-Control-Allow-Origin *;
  }
}

